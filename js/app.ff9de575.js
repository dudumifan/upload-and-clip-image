(function(t){function i(i){for(var n,a,r=i[0],c=i[1],l=i[2],u=0,h=[];u<r.length;u++)a=r[u],Object.prototype.hasOwnProperty.call(s,a)&&s[a]&&h.push(s[a][0]),s[a]=0;for(n in c)Object.prototype.hasOwnProperty.call(c,n)&&(t[n]=c[n]);m&&m(i);while(h.length)h.shift()();return o.push.apply(o,l||[]),e()}function e(){for(var t,i=0;i<o.length;i++){for(var e=o[i],n=!0,r=1;r<e.length;r++){var c=e[r];0!==s[c]&&(n=!1)}n&&(o.splice(i--,1),t=a(a.s=e[0]))}return t}var n={},s={app:0},o=[];function a(i){if(n[i])return n[i].exports;var e=n[i]={i:i,l:!1,exports:{}};return t[i].call(e.exports,e,e.exports,a),e.l=!0,e.exports}a.m=t,a.c=n,a.d=function(t,i,e){a.o(t,i)||Object.defineProperty(t,i,{enumerable:!0,get:e})},a.r=function(t){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},a.t=function(t,i){if(1&i&&(t=a(t)),8&i)return t;if(4&i&&"object"===typeof t&&t&&t.__esModule)return t;var e=Object.create(null);if(a.r(e),Object.defineProperty(e,"default",{enumerable:!0,value:t}),2&i&&"string"!=typeof t)for(var n in t)a.d(e,n,function(i){return t[i]}.bind(null,n));return e},a.n=function(t){var i=t&&t.__esModule?function(){return t["default"]}:function(){return t};return a.d(i,"a",i),i},a.o=function(t,i){return Object.prototype.hasOwnProperty.call(t,i)},a.p="/upload-and-clip-image/";var r=window["webpackJsonp"]=window["webpackJsonp"]||[],c=r.push.bind(r);r.push=i,r=r.slice();for(var l=0;l<r.length;l++)i(r[l]);var m=c;o.push([0,"chunk-vendors"]),e()})({0:function(t,i,e){t.exports=e("56d7")},2498:function(t,i,e){"use strict";var n=e("a0e8"),s=e.n(n);s.a},2544:function(t,i,e){},"3b8c":function(t,i,e){"use strict";var n=e("a9d3"),s=e.n(n);s.a},"46ee":function(t,i,e){"use strict";var n=e("2544"),s=e.n(n);s.a},"56d7":function(t,i,e){"use strict";e.r(i);e("e260"),e("e6cf"),e("cca6"),e("a79d");var n=e("2b0e"),s=function(){var t=this,i=t.$createElement,e=t._self._c||i;return e("section",{staticClass:"ad-img-mg"},[e("div",{staticClass:"ad-img-main"},[e("p",{staticClass:"ad-tips-p"},[t._v("使用说明：")]),e("p",{staticClass:"ad-tips-p"},[t._v(" 选择图片，拖动或缩放至合适大小，图片列表可顺序拖动更换。 ")]),e("upload-img",{attrs:{max_size:t.device_info.size,img_width:t.device_info.width,img_height:t.device_info.height,img_list:t.img_list},on:{uploadImg:t.uploadImg,removeImg:t.removeImg}})],1)])},o=[],a=(e("a4d3"),e("4de4"),e("4160"),e("e439"),e("dbb4"),e("b64b"),e("159b"),e("2fa7")),r=function(){var t=this,i=t.$createElement,e=t._self._c||i;return e("div",{staticClass:"my-upload"},[e("div",{staticClass:"my-upload-box",on:{click:t.selectFile}},[e("i",{staticClass:"el-icon-plus my-upload-icon"}),e("input",{ref:"input",staticClass:"my-upload-input",attrs:{type:"file",accept:"image/png, image/jpeg, image/jpg"},on:{change:t.inputOnChange}})]),e("p",{staticClass:"my-upload-tips"},[t._v("建议分辨率 "+t._s(t.img_width)+" * "+t._s(t.img_height)+" 或倍数，"+t._s(t.max_size)+"M以内的png、jpg图片")]),e("div",{staticClass:"my-upload-img-list"},[e("img-list",{attrs:{img_list:t.img_list,url:t.url,has_cover:t.has_cover},on:{removeImg:t.removeImg,setCover:t.setCover}})],1),t.show_cut_img?e("div",[e("cut-img",{attrs:{fileList:t.fileList,width:t.img_width,height:t.img_height},on:{cancelCut:t.cancelCut,setCutCoordinate:t.setCutCoordinate}})],1):t._e(),t.show_canvas?e("div",[e("my-canvas",{attrs:{coordinate:t.coordinate,fileList:t.fileList,width:t.img_width,height:t.img_height},on:{setBlob:t.setBlob,setImg:t.setImg}})],1):t._e()])},c=[],l=(e("b0c0"),e("a9e3"),function(){var t=this,i=t.$createElement,e=t._self._c||i;return e("div",{ref:"disabledselect"},[e("el-dialog",{attrs:{title:"图片编辑","close-on-click-modal":!1,"close-on-press-escape":!1,visible:t.dialogVisible,width:t.img_info._width>500?t.img_info._width+80+"px":"550px","before-close":t.cancel},on:{"update:visible":function(i){t.dialogVisible=i}}},[e("div",{staticClass:"cut-box",style:t.box_style_obj,on:{mousedown:t.mousedown,mousemove:t.mousemove,mouseup:t.mouseleave,mouseleave:t.mouseleave}},[e("img",{ref:"img",staticClass:"cut-img",style:t.img_style_obj,attrs:{width:"100%",src:t.img_src,alt:"图片剪切"},on:{click:!1}})]),e("div",{staticClass:"cut-slider"},[e("el-slider",{attrs:{min:t.img_info.min_mul,max:200},on:{input:t.changeImgMul},model:{value:t.img_info.mul,callback:function(i){t.$set(t.img_info,"mul",i)},expression:"img_info.mul"}})],1),e("div",{staticClass:"cut-btn-tips"},[e("div",{staticClass:"cut-btn"},[e("el-button",{on:{click:t.sub}},[t._v("-")]),e("span",[t._v(t._s(t.img_info.mul)+"%")]),e("el-button",{on:{click:t.add}},[t._v("+")])],1),e("ul",{staticClass:"cut-tips"},[e("li",[t._v("注1：鼠标拖动图片即可选择区域")]),e("li",[t._v("注2：所见即所得")])])]),e("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[e("el-button",{on:{click:t.cancel}},[t._v("取 消")]),e("el-button",{attrs:{type:"primary"},on:{click:t.confirm}},[t._v("裁切并上传")])],1)])],1)}),m=[],u=(e("99af"),e("4c53"),{name:"cutImg",props:{fileList:[String,FileList],width:Number,height:Number},data:function(){return{img_style_obj:{width:"100%",height:"100%"},box_style_obj:{width:"300px",height:"300px"},img_src:"",img_info:{min_mul:0,_mul:0,_min:250,_width:0,_height:0,b_w:0,b_h:0,mul:100,s_w:0,s_h:0},move_info:{o_x:0,o_y:0,move_x:0,move_y:0},is_move:!1,dialogVisible:!0}},created:function(){var t=this,i=new FileReader;i.onload=function(i){t.img_src=i.target.result},i.readAsDataURL(this.fileList[0])},mounted:function(){var t=this;this.$nextTick((function(){t.$refs.disabledselect.onselectstart=new Function("event.returnValue=false;"),t.$refs.img.onload=function(){t.img_info.b_h=t.$refs.img.naturalHeight,t.img_info.b_w=t.$refs.img.naturalWidth,t.width>=t.height?(t.img_info._height=t.img_info._min,t.img_info._mul=t.height/t.img_info._height,t.img_info._width=t.width/t.img_info._mul):(t.img_info._width=t.img_info._min,t.img_info._mul=t.width/t.img_info._width,t.img_info._height=t.height/t.img_info._mul),t.setMul(),t.box_style_obj={width:"".concat(t.img_info._width,"px"),height:"".concat(t.img_info._height,"px")}}}))},methods:{setMul:function(){while(this.sub())this.sub();this.img_info.min_mul=this.img_info.mul},changeImgMul:function(t){this.calcImgSize(t,1)},sub:function(){var t=this.img_info.mul;return t>1&&(t--,this.calcImgSize(t,1))},add:function(){var t=this.img_info.mul;return t<150&&(t++,this.calcImgSize(t,2))},calcImgSize:function(t,i){var e=this.img_info,n=e._height,s=e._width,o=this.move_info,a=o.move_x,r=o.move_y,c=this.img_info.b_w*t/100,l=this.img_info.b_h*t/100;return!(l<n||c<s)&&(1===i&&(Math.abs(r)+n>l&&(r+=this.img_info.s_h-l,r=r>=0?0:r,this.move_info.move_y=r),Math.abs(a)+s>c&&(a+=this.img_info.s_w-c,a=a>=0?0:a,this.move_info.move_x=a),this.$refs.img.style.transform="translate(".concat(a,"px, ").concat(r,"px)")),this.img_info.s_w=c,this.img_info.s_h=l,this.img_info.mul=t,this.img_style_obj={width:"".concat(this.img_info.s_w,"px"),height:"".concat(this.img_info.s_h,"px")},!0)},mousedown:function(t){var i=t.pageX,e=t.pageY;this.is_move=!0,this.move_info.o_x=i,this.move_info.o_y=e},mousemove:function(t){if(this.is_move){var i=this.getMoveDistance(t),e=i.move_x,n=i.move_y;this.$refs.img.style.transform="translate(".concat(e,"px, ").concat(n,"px)")}},mouseleave:function(t){if(this.is_move){var i=this.getMoveDistance(t),e=i.move_x,n=i.move_y;this.move_info.move_x=e,this.move_info.move_y=n,this.is_move=!1}},getMoveDistance:function(t){var i=t.pageX,e=t.pageY,n=this.img_info,s=n.s_w,o=n.s_h,a=n._width,r=n._height,c=this.move_info,l=c.o_x,m=c.o_y,u=this.move_info,h=u.move_x,_=u.move_y,g=0;return h=s<=a?0:i-l+h,_=o<=r?0:e-m+_,_>=0?_=0:Math.abs(_)>(g=o-r)&&(_=-g),h>=0?h=0:Math.abs(h)>(g=s-a)&&(h=-g),{move_x:h,move_y:_}},cancel:function(){this.dialogVisible=!1,this.$emit("cancelCut")},confirm:function(){var t=this.img_info,i=t.s_w,e=t.s_h,n=t.mul,s=t._mul,o=t._width,a=t._height,r=this.move_info,c=r.move_x,l=r.move_y,m=c/n*100,u=l/n*100,h=o/n*100,_=a/n*100;i<o||e<a?this.$message.error("图片尺寸不符合预期！"):(this.dialogVisible=!1,this.$emit("setCutCoordinate",{x:m,y:u,x1:h,y1:_,_mul:s,mul:n,img:this.$refs.img}))}}}),h=u,_=(e("2498"),e("2877")),g=Object(_["a"])(h,l,m,!1,null,"1a2f2686",null),f=g.exports,d=function(){var t=this,i=t.$createElement,e=t._self._c||i;return e("div",{staticClass:"upload-canvas"},[e("canvas",{ref:"canvas",attrs:{id:"canvas",width:this.canvas_width+"px",height:this.canvas_height+"px"}})])},v=[],p=(e("cb29"),{name:"my-canvas",props:{coordinate:{type:Object,required:!0},fileList:[String,FileList],width:Number,height:Number},data:function(){return{canvas_width:0,canvas_height:0}},created:function(){var t=this.coordinate,i=t.x1,e=t.y1;this.canvas_width=i>this.width?i:this.width,this.canvas_height=e>this.height?e:this.height},mounted:function(){var t=this;this.$nextTick((function(){t.createCanvas()}))},methods:{createCanvas:function(){var t=this.coordinate,i=t.x,e=t.y,n=t.img,s=t.x1,o=t.y1,a=this.$refs.canvas,r=a.getContext("2d");r.rect(0,0,this.canvas_width,this.canvas_height),r.fillStyle="#fff",r.fill(),r.drawImage(n,Math.abs(i),Math.abs(e),s,o,0,0,this.canvas_width,this.canvas_height);var c=a.toDataURL(this.fileList[0].type);this.$emit("setImg",{img_data:c})}}}),b=p,w=(e("8e36"),Object(_["a"])(b,d,v,!1,null,"7fcd51d2",null)),y=w.exports,x=function(){var t=this,i=t.$createElement,e=t._self._c||i;return e("div",{staticClass:"img-list"},[e("draggable",{attrs:{list:t.img_list,options:{group:t.draggable_group_name}}},t._l(t.img_list,(function(i,n){return e("div",{key:n,staticClass:"upload-img-box"},[e("img",{staticClass:"upload-img",attrs:{src:i[t.url],alt:""}}),e("span",{staticClass:"upload-icons"},[e("div",[e("span",{staticClass:"upload-icons-preview",on:{click:function(e){return t.handlePictureCardPreview(i)}}},[e("i",{staticClass:"el-icon-zoom-in"})]),t.disabled?t._e():e("span",{staticClass:"upload-icons-delete",on:{click:function(e){return t.handleRemove(i,n)}}},[e("i",{staticClass:"el-icon-delete"})])]),t.has_cover?e("div",{staticClass:"upload-cover"},[e("el-button",{attrs:{type:"primary",disabled:!!i.is_cover,size:"mini"},on:{click:function(e){return t.setCover(i,n)}}},[t._v(t._s(i.is_cover?"当前封面":"设为封面"))])],1):t._e()])])})),0),e("el-dialog",{attrs:{visible:t.dialogVisible,width:"70%"},on:{"update:visible":function(i){t.dialogVisible=i}}},[e("img",{attrs:{width:"100%",src:t.preview_src,alt:""}})])],1)},C=[],O=e("310e"),I=e.n(O),j={name:"myUploadImgList",props:{img_list:{type:Array,required:!0},has_cover:{type:Boolean,default:!1},url:{type:String,default:"url"},draggable_group_name:String},data:function(){return{disabled:!1,preview_src:"",dialogVisible:!1,dragover:!1}},methods:{onDrop:function(){},onDragover:function(){},handlePictureCardPreview:function(t){this.preview_src=t.url,this.dialogVisible=!0},handleRemove:function(t,i){var e=this;this.$confirm("您确定删除此图片么，删除后无法恢复！",{closeOnClickModal:!1,type:"warning"}).then((function(){e.$emit("removeImg",{file:t,idx:i})})).catch((function(){e.$message({type:"info",message:"已取消操作"})}))},setCover:function(t,i){var e=this;this.$confirm("您确定要设置该图片为封面吗！",{closeOnClickModal:!1,type:"warning"}).then((function(){e.$emit("setCover",{file:t,idx:i})})).catch((function(){e.$message({type:"info",message:"已取消操作"})}))}},components:{draggable:I.a}},$=j,M=(e("e426"),Object(_["a"])($,x,C,!1,null,"7425fc85",null)),k=M.exports,z={name:"myUploadImg",props:{img_width:{type:Number,default:200},img_height:{type:Number,default:200},max_size:{type:Number,default:5},img_list:{type:Array,required:!0},has_cover:{type:Boolean,default:!1},draggable_group_name:{type:String,default:"img"},url:{type:String,default:"url"}},data:function(){return{dialogImageUrl:"",dialogVisible:!1,disabled:!1,fileList:"",show_cut_img:!1,show_canvas:!1,coordinate:{},max_size_bit:0}},created:function(){this.max_size_bit=1048576*this.max_size},watch:{max_size:function(t){this.max_size_bit=1048576*t}},methods:{selectFile:function(){this.$refs.input.click(),this.$refs.input.value=""},inputOnChange:function(t){var i=t.target.files;i&&(i[0].size>this.max_size_bit?this.$message.error("图片过大, 最大支持".concat(this.max_size,"M")):(this.fileList=i,this.show_cut_img=!0,this.show_canvas=!1))},setCutCoordinate:function(t){this.coordinate=t,this.show_canvas=!0,this.cancelCut()},cancelCut:function(){this.show_cut_img=!1},setBlob:function(t){var i=t._img_date,e=this.fileList[0].name,n=this.fileList[0].type;i=new Blob([i],{type:n});var s=new FormData;s.append("file",i,e),this.$emit("uploadImg",s)},setImg:function(t){this.$emit("uploadImg",t)},removeImg:function(t){this.$emit("removeImg",t)},setCover:function(t){this.$emit("setCover",t)}},components:{cutImg:f,myCanvas:y,imgList:k}},P=z,S=(e("3b8c"),Object(_["a"])(P,r,c,!1,null,"60fb8b0c",null)),L=S.exports,D=e("2f62");function V(t,i){var e=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);i&&(n=n.filter((function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable}))),e.push.apply(e,n)}return e}function E(t){for(var i=1;i<arguments.length;i++){var e=null!=arguments[i]?arguments[i]:{};i%2?V(Object(e),!0).forEach((function(i){Object(a["a"])(t,i,e[i])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(e)):V(Object(e)).forEach((function(i){Object.defineProperty(t,i,Object.getOwnPropertyDescriptor(e,i))}))}return t}var F={name:"imgUpload",data:function(){return{device_info:{size:5,width:400,height:400}}},methods:E({},Object(D["b"])(["addImg","removeImg"]),{uploadImg:function(t){this.addImg(t)},removeImg:function(t){this.removeImg(t)}}),computed:E({},Object(D["c"])(["img_list"])),components:{uploadImg:L}},N=F,R=(e("46ee"),Object(_["a"])(N,s,o,!1,null,"bf6db864",null)),B=R.exports;e("a434");n["default"].use(D["a"]);var U=new D["a"].Store({state:{img_list:[]},mutations:{ADD_IMG:function(t,i){var e=0===t.img_list.length;t.img_list.push({url:i.img_data,is_cover:e})},REMOVE_IMG:function(t,i){t.img_list.splice(i.idx,1)}},actions:{addImg:function(t,i){var e=t.commit;e("ADD_IMG",i)},removeImg:function(t,i){var e=t.commit;e("REMOVE_IMG",i)}},modules:{},getters:{img_list:function(t){return t.img_list}}}),A=e("5c96"),T=e.n(A);e("0fae");n["default"].use(T.a),n["default"].config.productionTip=!1,new n["default"]({store:U,render:function(t){return t(B)}}).$mount("#app")},8300:function(t,i,e){},"8e36":function(t,i,e){"use strict";var n=e("c35f"),s=e.n(n);s.a},a0e8:function(t,i,e){},a9d3:function(t,i,e){},c35f:function(t,i,e){},e426:function(t,i,e){"use strict";var n=e("8300"),s=e.n(n);s.a}});
//# sourceMappingURL=app.ff9de575.js.map